<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#fbfdff" />
  <meta name="color-scheme" content="light" />
  <title data-i18n="digitalkz">Digital.kz</title>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Playfair+Display:wght@600;700&display=swap" rel="stylesheet" />

  <!-- Tailwind CSS (utility) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            jewel: {
              sapphire: '#B5CEF5',
              emerald:  '#2E6D9C'
            }
          },
          fontFamily: { sans: ['Poppins','system-ui','sans-serif'], serif: ['Playfair Display','serif'] },
          boxShadow: { card:'0 10px 30px rgba(2, 6, 23, .06)', float:'0 20px 50px rgba(46,109,156,.22)' },
          borderRadius: { xxl: '1.25rem' }
        }
      }
    }
  </script>

  <!-- Icons / Animations -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" rel="stylesheet"/>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" rel="stylesheet"/>

  <!-- App translations -->
  <script defer src="/static/js/translate.js"></script>

  <!-- Light UI Layer + ЧИСТАЯ АДАПТИВКА -->
  <style>
    :root{
      --bg: #fbfdff;
      --panel: #ffffff;
      --ink: #0f172a;
      --muted: #475569;
      --primary: #B5CEF5; /* новый Primary */
      --secondary: #2E6D9C; /* новый Secondary */
    }

    /* Глобальные фиксы */
    html{scroll-behavior:smooth}
    *,*::before,*::after{box-sizing:border-box}
    html,body{overflow-x:hidden}
    img,video{max-width:100%;height:auto;display:block}
    body{background:var(--bg); color:var(--ink); font-family:'Poppins',system-ui,sans-serif}
    .container{max-width:1200px; margin:0 auto; padding:0 16px}

    /* ====== HEADER ====== */
    .mobile-header{position:sticky; top:0; inset-inline:0; height:64px; display:flex; align-items:center; justify-content:space-between; padding:0 16px; background:rgba(255,255,255,.9); backdrop-filter: blur(10px); z-index:50; border-bottom:1px solid rgba(2,6,23,.06)}
    .burger-menu{width:28px; height:20px; display:flex; flex-direction:column; justify-content:space-between; cursor:pointer}
    .burger-menu span{height:3px; background:var(--ink); border-radius:3px; transition:.25s}
    .burger-menu.active span:nth-child(1){transform:translateY(8px) rotate(45deg)}
    .burger-menu.active span:nth-child(2){opacity:0}
    .burger-menu.active span:nth-child(3){transform:translateY(-8px) rotate(-45deg)}

    /* ====== SIDEBAR ====== */
    .sidebar{position:fixed; top:0; left:0; height:100vh; width:320px; background:var(--panel); box-shadow:0 12px 40px rgba(2,6,23,.08); transform:translateX(-100%); transition:.3s transform; z-index:60; overflow:auto}
    .sidebar.mobile-active{transform:translateX(0)}
    .menu-overlay{position:fixed; inset:0; background:rgba(15,23,42,.28); opacity:0; visibility:hidden; transition:.25s; z-index:55}
    .menu-overlay.active{opacity:1; visibility:visible}

    .profile-card{padding:18px 16px; display:flex; align-items:center; gap:12px; text-align:left}
    .profile-card .avatar{width:72px; height:72px; border-radius:9999px; border:3px solid var(--primary); object-fit:cover; box-shadow:0 8px 20px rgba(46,109,156,.22); flex:0 0 auto; cursor:pointer}
    @media(min-width:480px){ .profile-card .avatar{width:84px;height:84px} }
    .email{color:#64748b; font-size:.85rem; line-height:1.2}
    .rating{display:inline-flex; align-items:center; gap:.45rem; padding:.35rem .7rem; border-radius:999px; background:#eff6ff; color:var(--secondary); margin-top:6px}

    .menu{display:flex; flex-direction:column; gap:6px; padding: 8px 14px 18px}
    .menu a{display:flex; align-items:center; gap:.7rem; padding:10px 12px; border-radius:12px; color:var(--ink); text-decoration:none; transition:.2s background,.2s transform}
    .menu a:hover{background:#f8fafc; transform:translateX(2px)}

    .lang-switcher{margin:12px 14px 20px; display:flex; gap:6px; background:#f1f5f9; border-radius:999px; padding:6px}
    .lang-btn{flex:1; border:0; background:transparent; color:var(--ink); padding:.45rem .7rem; border-radius:999px; font-weight:600; cursor:pointer}
    .lang-btn.active{background:var(--secondary); color:white}

    .promo-banner{margin: 0 14px 24px; border-radius:18px; padding:18px; background:linear-gradient(135deg,#EAF2FE,#ffffff); color:#243c5a; box-shadow:0 10px 24px rgba(46,109,156,.15)}
    .btn-premium{border:0; width:100%; margin-top:12px; padding:10px 14px; border-radius:12px; background:var(--secondary); color:white; font-weight:700; cursor:pointer}

    .avatar-wrap{position:relative; display:inline-block}
    .avatar-badge{position:absolute; right:-2px; bottom:-2px; width:24px; height:24px; border-radius:999px; background:var(--secondary); color:#fff; display:grid; place-items:center; font-size:.8rem; box-shadow:0 4px 10px rgba(46,109,156,.25)}
    .profile-meta h2{margin:0; font-weight:600; font-size:1rem}
    .profile-meta{display:flex; flex-direction:column}

    /* ====== HERO (переписан, чистая адаптивка) ====== */
    .hero{position:relative; isolation:isolate}
    .hero .hero-inner{min-height:clamp(72vh, 100svh - 64px, 92vh); display:flex; align-items:center}
    .hero-grid{display:grid; grid-template-columns:1fr; gap:24px; width:100%}
    .hero h1{font-family:'Playfair Display',serif; font-weight:700; line-height:1.15; letter-spacing:-.01em; font-size:clamp(1.8rem,6vw,3.4rem); margin:0 0 .5rem}
    .hero p{max-width:52ch; color:#475569}
    .hero-cta{display:flex; gap:12px; flex-wrap:wrap; margin-top:16px}
    .yakor-button{display:inline-flex; align-items:center; gap:.6rem; padding: .95rem 1.35rem; border-radius:999px; background:linear-gradient(180deg, var(--secondary), var(--primary)); color:white; font-weight:800; box-shadow:0 12px 30px rgba(46,109,156,.28); transition:transform .18s}
    .yakor-button:hover{transform:translateY(-2px)}
    .btn-ghost{padding:.9rem 1.2rem; border-radius:999px; background:#ffffff; border:1px solid var(--primary); color:var(--secondary); font-weight:700}

    /* Desktop split */
    @media(min-width:1024px){
      .hero-grid{grid-template-columns: 1.1fr .9fr}
      .hero-media{display:block}
    }

    /* Mobile: full-bleed image background */
    @media(max-width:1023.98px){
      .hero{background-image: linear-gradient(180deg, rgba(255,255,255,.95), rgba(255,255,255,.92)), url('https://images.unsplash.com/photo-1500530855697-b586d89ba3ee?q=80&w=1600&auto=format&fit=crop'); background-size:cover; background-position:center}
      .hero-media{display:none}
      .hero .hero-inner{padding-block:clamp(1.25rem,6vh,2.25rem)}
      .hero h1,.hero p{text-align:center; margin-left:auto; margin-right:auto}
      .hero-cta{justify-content:center}
    }

    /* Hero media card */
    .hero-media{width:100%; max-width:580px; margin:0 auto}
    .hero-media img{width:100%; height:clamp(280px,60vh,560px); object-fit:cover; border-radius:24px; box-shadow:0 18px 46px rgba(2,6,23,.16); border:6px solid #ffffff}

    /* ====== FEATURES ====== */
    .features-section{padding:24px 0 4px}
    .features{display:grid; grid-template-columns:repeat(auto-fit,minmax(220px,1fr)); gap:14px}
    .feature{background:var(--panel); border:1px solid #e2e8f0; border-radius:16px; padding:16px}

    /* ====== STATS ====== */
    .stats{display:grid; grid-template-columns:repeat(3,1fr); gap:16px; margin-top:16px}
    @media (max-width: 900px){ .stats{grid-template-columns:1fr 1fr} }
    @media (max-width: 640px){ .stats{grid-template-columns:1fr} }
    .stat{background:var(--panel); border:1px solid #e2e8f0; border-radius:16px; padding:14px 18px; text-align:center}
    .stat h4{font-size:1.6rem; font-weight:800; color:var(--secondary)}

    /* ====== ROUTES (карточки в сетке) ====== */
    .routes{display:grid; grid-template-columns:repeat(auto-fit,minmax(260px,1fr)); gap:22px; padding: 42px 16px; max-width:1200px; margin:0 auto}
    .route-option{background:var(--panel); border-radius:18px; overflow:hidden; box-shadow: var(--shadow-card, 0 12px 28px rgba(2,6,23,.06)); transition:.25s transform,.25s box-shadow}
    .route-option:hover{transform: translateY(-6px); box-shadow:0 20px 44px rgba(2,6,23,.12)}
    .route-option img{aspect-ratio:16/10; object-fit:cover; width:100%}
    .route-option .info{padding:16px}

    /* ====== POPULAR ====== */
    .popular-routes{padding:48px 0; background:#f4f8ff}
    .popular-scroll{display:flex; gap:16px; overflow-x:auto; -webkit-overflow-scrolling:touch; scroll-snap-type:x proximity; padding: 10px 16px}
    .popular-scroll{scroll-padding-left:16px}
    .popular-card{scroll-snap-align:center; background:var(--panel); border:1px solid #e2e8f0; border-radius:16px; overflow:hidden; width:clamp(260px, 82vw, 320px); box-shadow:0 8px 22px rgba(2,6,23,.06); transition:.2s transform; flex:0 0 auto}
    .popular-card:hover{transform: translateY(-4px)}
    .popular-card img{width:100%; height:180px; object-fit:cover}
    .popular-card .info{padding:14px; position:relative}
    .popular-card .meta{display:flex; gap:10px; flex-wrap:wrap; font-size:.88rem; color:#475569}
    .popular-card .popularity{position:absolute; right:14px; bottom:14px; background:var(--secondary); color:white; border-radius:999px; padding:.2rem .55rem; font-weight:700; font-size:.82rem}
    .actions{display:flex; padding: 0 14px 14px}
    .actions a{font-weight:700; color:var(--secondary)}

    /* ====== TESTIMONIALS ====== */
    .testimonials{background:linear-gradient(180deg,#eef4ff,#ffffff); color:#0b3b59; padding:56px 0}
    .testimonial-slider{max-width:980px; margin:auto; padding:0 16px}
    .testimonial-slide{display:none; background:var(--panel); border:1px solid #e2e8f0; border-radius:18px; padding:22px}
    .testimonial-slide.active{display:block; animation:fadeIn .25s ease}
    .testimonial-avatar{width:84px; height:84px; border-radius:999px; border:3px solid var(--primary); object-fit:cover; margin:0 auto 12px}
    .testimonial-nav{display:flex; justify-content:center; gap:10px; margin-top:16px}
    .testimonial-dot{width:10px; height:10px; border-radius:999px; background:#c7d2fe; cursor:pointer}
    .testimonial-dot.active{background:var(--secondary)}

    /* ====== NEWSLETTER ====== */
    .newsletter{padding:48px 0; background:#f8fbff; text-align:center}
    .newsletter-form{max-width:640px; margin:auto; display:flex; flex-wrap:wrap; gap:12px; justify-content:center; padding:0 16px}
    .newsletter-input{flex:1 1 260px; padding:14px 16px; border-radius:12px; border:1px solid #e2e8f0; background:var(--panel); color:var(--ink)}
    .newsletter-input:focus{outline:2px solid #B5CEF5; box-shadow:0 0 0 3px rgba(46,109,156,.12)}
    .newsletter-button{padding:14px 18px; border:0; border-radius:12px; font-weight:800; background:var(--secondary); color:white; cursor:pointer}

    /* ====== FAQ ====== */
    details.faq{background:var(--panel); border:1px solid #e2e8f0; border-radius:14px; padding:14px 16px}
    details.faq summary{cursor:pointer; font-weight:700}

    /* ====== FOOTER ====== */
    .footer-wave svg{display:block; width:calc(100% + 1.3px); height:80px}
    .quick-link{position:relative}
    .quick-link:after{content:""; position:absolute; inset-inline:0; bottom:-2px; height:2px; width:0; background:#ffffff; transition:width .2s}
    .quick-link:hover:after{width:100%}

    @keyframes fadeIn{from{opacity:0; transform:translateY(4px)} to{opacity:1; transform:none}}

    /* Мелкий спиннер на бейдже при загрузке */
    .uploading{ animation:spin 1s linear infinite }
    @keyframes spin{ to{ transform:rotate(360deg) } }
  </style>
</head>

<body>
  <div class="dashboard-container">
    <!-- Header (mobile) -->
    <header>
      <div class="mobile-header">
        <div class="burger-menu" id="burger-menu"><span></span><span></span><span></span></div>
        <div class="flex items-center gap-3">
          <img class="mobile-logo h-8" src="{{ url_for('static', filename='img/logo.png') }}" alt="Logo" />
          <span class="font-bold text-[color:var(--secondary)] hidden sm:block">Almaways</span>
        </div>
        <div class="hidden sm:flex items-center gap-2">
          {% if current_user.is_authenticated %}
            <a href="/user_office" class="py-2 px-3 rounded-full bg-[color:var(--secondary)] text-white text-sm font-semibold">Личный кабинет</a>
          {% else %}
            <a href="/user_reg" class="py-2 px-3 rounded-full bg-[color:var(--secondary)] text-white text-sm font-semibold">Войти</a>
          {% endif %}
        </div>
      </div>
    </header>

    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
      <div class="profile-card">
        <form id="avatar-form" enctype="multipart/form-data" class="profile-photo" onsubmit="return false;">
          <label for="avatar-input" class="avatar-wrap" id="avatar-label">
            <img id="avatar-img" class="avatar" alt="avatar"
                 src="{{ url_for('static', filename='avatars/' ~ (current_user.avatar or 'default.png')) }}" />
            <span class="avatar-badge" id="avatar-badge"><i class="fa fa-camera"></i></span>
          </label>
          <input id="avatar-input" name="avatar" type="file" accept="image/png,image/jpeg,image/webp" style="display:none" />
        </form>
        <div class="profile-meta">
          <h2>{{ current_user.name }} {{ current_user.surname }}</h2>
          <p class="email">{{ current_user.email }}</p>
          <div class="rating"><i class="fas fa-star"></i><span data-i18n="48">4.8</span></div>
        </div>
      </div>

      <nav class="menu">
        <a href="/index"><i class="fas fa-home"></i>Главная</a>
        {% if current_user.is_authenticated %}
          <a href="/favourites"><i class="fas fa-route"></i> Мои маршруты</a>
        {% else %}
          <a href="/user_reg"><i class="fas fa-route"></i> Мои маршруты</a>
        {% endif %}
        {% if current_user.is_authenticated %}
          <a href="/user_office"><i class="fas fa-user"></i>Личный кабинет</a>
          <a href="/logout"><i class="fas fa-sign-out-alt"></i> Выход</a>
        {% else %}
          <a href="/user_reg"><i class="fas fa-sign-in-alt"></i>Войти</a>
        {% endif %}
      </nav>

      <div class="lang-switcher" id="lang-switcher">
        <button class="lang-btn active" data-lang="ru">🇷🇺 RU</button>
        <button class="lang-btn" data-lang="kz">🇰🇿 KZ</button>
        <button class="lang-btn" data-lang="en">🇬🇧 EN</button>
      </div>

      <div class="promo-banner">
        <h3 data-i18n="_">Премиум доступ</h3>
        <p data-i18n="___">Откройте офлайн-трек, экспорт GPX и AR-подсказки</p>
        <button class="btn-premium" data-i18n="">Активировать</button>
      </div>
    </aside>
    <div class="menu-overlay" id="menu-overlay"></div>

    <!-- HERO -->
    <section class="hero">
      <div class="hero-inner container">
        <div class="hero-grid">
          <div>
            <h1 class="animate__animated animate__fadeInUp" data-i18n="_____1">Планируйте лёгкие поездки по Казахстану</h1>
            <p class="mt-3 mb-6 text-slate-600 animate__animated animate__fadeInUp animate__delay-1s" data-i18n="_______2">Собирайте идеальные маршруты за минуты — готовые подборки мест, время в пути и чек-листы на каждый день.</p>
            <div class="hero-cta animate__animated animate__fadeInUp animate__delay-2s">
              <a href="#choose" class="yakor-button"><span data-i18n="_">Выбрать направление</span><i class="fa-solid fa-arrow-right"></i></a>
              {% if current_user.is_authenticated %}
              <a href="/favourites" class="btn-ghost">Открыть избранное</a>
              {% else %}
              <a href="/user_reg" class="btn-ghost">Войти, чтобы сохранить</a>
              {% endif %}
            </div>
          </div>
          <div class="hero-media">
            <img loading="lazy" alt="Almaty mountains"
                 src="https://images.unsplash.com/photo-1500530855697-b586d89ba3ee?q=80&w=1600&auto=format&fit=crop" />
          </div>
        </div>
      </div>
    </section>

    <!-- FEATURES -->
    <section class="features-section">
      <div class="container">
        <div class="features">
          <div class="feature">
            <div class="font-semibold mb-1">Готовые дневные планы</div>
            <div class="text-slate-600 text-sm">Распределяем локации по времени + удобные точки питания.</div>
          </div>
          <div class="feature">
            <div class="font-semibold mb-1">Офлайн GPX</div>
            <div class="text-slate-600 text-sm">Экспорт треков в 1 клик для путешествий без интернета.</div>
          </div>
          <div class="feature">
            <div class="font-semibold mb-1">Локальные инсайты</div>
            <div class="text-slate-600 text-sm">Лайфхаки по транспорту, парковке и «точкам с видом».</div>
          </div>
          <div class="feature">
            <div class="font-semibold mb-1">Шеринг</div>
            <div class="text-slate-600 text-sm">Делитесь планом поездки с друзьями в один тап.</div>
          </div>
        </div>
        <div class="stats">
          <div class="stat"><h4>120+</h4><p>Маршрутов по стране</p></div>
          <div class="stat"><h4>4.8★</h4><p>Средняя оценка пользователей</p></div>
          <div class="stat"><h4>24/7</h4><p>Поддержка и обратная связь</p></div>
        </div>
      </div>
    </section>

    <!-- ROUTE OPTIONS -->
    <section class="routes" id="choose">
      <div class="route-option">
        <a href="/cultural_routes" style="text-decoration:none;color:inherit">
          <img loading="lazy" src="https://images.unsplash.com/photo-1558981285-6f0c94958bb6?q=80&w=1400&auto=format&fit=crop" alt="Культура и еда"/>
          <div class="info">
            <h3 data-i18n="____">🏛️ Культурное и гастрономическое погружение</h3>
            <p data-i18n="____">Наследие, музеи, рынки и кухня — в одном маршруте.</p>
          </div>
        </a>
      </div>
      <div class="route-option">
        <a href="/cultural_routes" style="text-decoration:none;color:inherit">
          <img loading="lazy" src="https://images.unsplash.com/photo-1500530855697-b586d89ba3ee?q=80&w=1400&auto=format&fit=crop" alt="Горы и природа"/>
          <div class="info">
            <h3>🏔️ Горы и озёра</h3>
            <p>Панорамные трейлы, каньоны и изумрудные чаши озёр.</p>
          </div>
        </a>
      </div>
      <div class="route-option">
        <a href="/cultural_routes" style="text-decoration:none;color:inherit">
          <img loading="lazy" src="https://images.unsplash.com/photo-1512453979798-5ea266f8880c?q=80&w=1400&auto=format&fit=crop" alt="Городские прогулки"/>
          <div class="info">
            <h3>🌇 Городские прогулки</h3>
            <p>Пешеходные маршруты, стрит-арт и кофейни с атмосферой.</p>
          </div>
        </a>
      </div>
    </section>

    <!-- POPULAR ROUTES -->
    <section class="popular-routes">
      <div class="container">
        <h2 class="text-center text-2xl font-bold mb-2" data-i18n="_">Популярные маршруты</h2>
        <p class="text-center text-slate-600 mb-4">Выбор пользователей за последние 30 дней</p>
        {% if not popular_routes %}
          <p class="no-routes text-center" data-i18n="_____">Пока нет данных о популярных маршрутах</p>
        {% else %}
          <div class="popular-scroll" id="popular-scroll-id">
            {% for route in popular_routes %}
              <div class="popular-card">
                <img loading="lazy" alt="{{ route.title|default('Маршрут') }}" src="{{ route.image_url if route.image_url else url_for('static', filename='img/default_route.jpg') }}" />
                <div class="info">
                  <h3>{{ route.title|default('Без названия') }}</h3>
                  <p class="description">{{ route.description|default('', true)|truncate(80) }}</p>
                  <div class="meta"><span>⏱ {{ route.duration|default(0) }} ч</span><span>⚡ {{ route.difficulty|default('—') }}</span></div>
                  <div class="popularity">{% set pop = route.popularity|default(0.0) %}★ {{ "%.0f"|format(pop * 50) }}%</div>
                </div>
                <div class="actions">
                  <a data-i18n="!!" href="{{ url_for('cul_dynamic', route_id=route.id) }}">Подробнее</a>
                </div>
              </div>
            {% endfor %}
          </div>
        {% endif %}
      </div>
    </section>

    <!-- TESTIMONIALS -->
    <section class="testimonials" id="testimonials">
      <div class="container">
        <h2 class="section-title text-center text-2xl font-bold mb-6" data-i18n="_">Отзывы путешественников</h2>
        <div class="testimonial-slider">
          <div class="testimonial-slide active">
            <img class="testimonial-avatar" src="https://randomuser.me/api/portraits/women/44.jpg" alt="Sarah Johnson"/>
            <p class="testimonial-quote">«Нашли идеальный план выходных: Кок-Тобе + кофейни — всё по шагам. Супер удобно»</p>
            <h5 class="testimonial-author">Sarah Johnson</h5>
            <p class="testimonial-role">Traveler</p>
          </div>
          <div class="testimonial-slide">
            <img class="testimonial-avatar" src="https://randomuser.me/api/portraits/men/32.jpg" alt="Michael Chen"/>
            <p class="testimonial-quote">«Скачал GPX, уехали в Чарын без сети — нигде не заблудились»</p>
            <h5 class="testimonial-author">Michael Chen</h5>
            <p class="testimonial-role">Photographer</p>
          </div>
          <div class="testimonial-slide">
            <img class="testimonial-avatar" src="https://randomuser.me/api/portraits/women/68.jpg" alt="Elena Petrova"/>
            <p class="testimonial-quote">«Чек-лист рынка спас—купили всё вкусное и не переплатили»</p>
            <h5 class="testimonial-author">Elena Petrova</h5>
            <p class="testimonial-role">Blogger</p>
          </div>
          <div class="testimonial-nav">
            <div class="testimonial-dot active" data-slide="0"></div>
            <div class="testimonial-dot" data-slide="1"></div>
            <div class="testimonial-dot" data-slide="2"></div>
          </div>
        </div>
      </div>
    </section>

    <!-- FAQ -->
    <section class="max-w-4xl mx-auto px-4 pb-10 space-y-3">
      <details class="faq"><summary>Можно ли пользоваться офлайн?</summary><div class="mt-2 text-slate-600">Да, экспортируйте GPX и загрузите маршрут заранее.</div></details>
      <details class="faq"><summary>Как поделиться маршрутом?</summary><div class="mt-2 text-slate-600">Откройте карточку маршрута → «Поделиться» → выберите мессенджер.</div></details>
      <details class="faq"><summary>Будет ли поддержка EN/KZ?</summary><div class="mt-2 text-slate-600">Да, переключатель языка уже работает в сайдбаре.</div></details>
    </section>

    <!-- NEWSLETTER -->
    <section class="newsletter" id="contact">
      <h2 class="section-title" data-i18n="__">Оставайтесь с нами</h2>
      <p class="mb-8 max-w-2xl mx-auto" data-i18n="________________">Подпишитесь, чтобы первыми получать новые маршруты и подборки.</p>
      <form class="newsletter-form">
        <input class="newsletter-input" type="email" placeholder="Ваш email" required />
        <button class="newsletter-button" type="submit" data-i18n="">Подписаться</button>
      </form>
    </section>

    <!-- FOOTER -->
    <div class="relative bg-[color:var(--secondary)] text-white pt-16 pb-10 overflow-hidden">
      <div class="footer-wave">
        <svg viewBox="0 0 1200 120" preserveAspectRatio="none" xmlns="http://www.w3.org/2000/svg">
          <path class="shape-fill" fill="#ffffff" opacity=".25" d="M0,0V46.29c47.79,22.2,103.59,32.17,158,28,70.36-5.37,136.33-33.31,206.8-37.5C438.64,32.43,512.34,53.67,583,72.05c69.27,18,138.3,24.88,209.4,13.08,36.15-6,69.85-17.84,104.45-29.34C989.49,25,1113-14.29,1200,52.47V0Z"/>
          <path class="shape-fill" fill="#ffffff" opacity=".5" d="M0,0V15.81C13,36.92,27.64,56.86,47.69,72.05,99.41,111.27,165,111,224.58,91.58c31.15-10.15,60.09-26.07,89.67-39.8,40.92-19,84.73-46,130.83-49.67,36.26-2.85,70.9,9.42,98.6,31.56,31.77,25.39,62.32,62,103.63,73,40.44,10.79,81.35-6.69,119.13-24.28s75.16-39,116.92-43.05c59.73-5.85,113.28,22.88,168.9,38.84,30.2,8.66,59,6.17,87.09-7.5,22.43-10.89,48-26.93,60.65-49.24V0Z"/>
          <path class="shape-fill" fill="#ffffff" d="M0,0V5.63C149.93,59,314.09,71.32,475.83,42.57c43-7.64,84.23-20.12,127.61-26.46,59-8.63,112.48,12.24,165.56,35.4C827.93,77.22,886,95.24,951.2,90c86.53-7,172.46-45.71,248.8-84.81V0Z"/>
        </svg>
      </div>

      <div class="container footer-content">
        <div class="flex flex-col md:flex-row justify-between items-center md:items-start gap-10">
          <!-- Contact Info -->
          <div class="text-center md:text-left">
            <h3 class="text-2xl font-bold mb-4 flex items-center justify-center md:justify-start"><i class="fas fa-phone-alt mr-2"></i>Связаться с нами</h3>
            <div class="space-y-2">
              <p class="flex items-center justify-center md:justify-start"><i class="fas fa-phone mr-2"></i><a class="hover:text-white transition quick-link" href="tel:+77073783486" data-i18n="7_707_3783486">+7 (747) 784-08-76</a></p>
              <p class="flex items-center justify-center md:justify-start"><i class="fas fa-envelope mr-2"></i><a class="hover:text-white transition quick-link" href="mailto:demindmitry.vv@gmail.com" data-i18n="demindmitry.vvcom">demindmitry.vv@gmail.com</a></p>
              <p class="flex items-center justify-center md:justify-start"><i class="fas fa-map-marker-alt mr-2"></i><a class="hover:text-white transition quick-link" href="https://yandex.kz/maps/ru/org/1107720387/" target="_blank" data-i18n="zharkova_24_almaty">Zharkova 24, Almaty</a></p>
            </div>
          </div>

          <!-- Social Media -->
          <div class="text-center">
            <h3 class="text-2xl font-bold mb-4" data-i18n="follow_us">Follow Us</h3>
            <div class="flex gap-3 justify-center">
              <a class="social-icon" href="https://www.instagram.com/maxigic/" target="_blank"><i class="fab fa-instagram text-xl"></i></a>
              <a class="social-icon" href="https://t.me/almaways" target="_blank"><i class="fab fa-telegram text-xl"></i></a>
              <a class="social-icon" href="https://www.youtube.com/@Almaways" target="_blank"><i class="fab fa-youtube text-xl"></i></a>
              <a class="social-icon" href="https://www.tiktok.com/@almaways" target="_blank"><i class="fab fa-tiktok text-xl"></i></a>
            </div>
          </div>

          <!-- Quick Links -->
          <div class="text-center md:text-left">
            <h3 class="text-2xl font-bold mb-4" data-i18n="quick_links">Quick Links</h3>
            <ul class="space-y-2">
              <li data-i18n="home"><a class="hover:text-white transition quick-link" href="#" data-i18n="home">Home</a></li>
              <li data-i18n="about_us"><a class="hover:text-white transition quick-link" href="#" data-i18n="about_us">About Us</a></li>
              <li data-i18n="services"><a class="hover:text-white transition quick-link" href="#" data-i18n="services">Services</a></li>
              <li data-i18n="contact"><a class="hover:text-white transition quick-link" href="#" data-i18n="contact">Contact</a></li>
            </ul>
          </div>
        </div>

        <div class="border-t border-white/30 mt-10 pt-6 text-center">
          <p data-i18n="_2023_almaways_all_rights_reserved">© 2023 Almaways. All rights reserved.</p>
          <p class="mt-2 text-sm text-white/90">Designed for humans</p>
        </div>
      </div>
    </div>
  </div>

  <!-- ====== JS (сохранён функционал) ====== -->
  <script>
    // 0) I18n boot
    window.addEventListener('load', () => { if (typeof loadTranslations === 'function') { loadTranslations('ru'); } });

    // 1) Mobile sidebar
    const burger = document.getElementById('burger-menu');
    const sidebar = document.getElementById('sidebar');
    const overlay = document.getElementById('menu-overlay');
    function toggleSidebar(){
      burger.classList.toggle('active');
      sidebar.classList.toggle('mobile-active');
      overlay.classList.toggle('active');
      document.body.style.overflow = sidebar.classList.contains('mobile-active') ? 'hidden' : ''
    }
    burger.addEventListener('click', toggleSidebar);
    overlay.addEventListener('click', toggleSidebar);

    // 2) Lang switcher
    const switcher = document.getElementById('lang-switcher');
    if (switcher){
      switcher.querySelectorAll('.lang-btn').forEach(btn=>{
        btn.addEventListener('click',()=>{
          switcher.querySelectorAll('.lang-btn').forEach(b=>b.classList.remove('active'));
          btn.classList.add('active');
          if (typeof loadTranslations === 'function') loadTranslations(btn.dataset.lang);
        })
      })
    }

    // 3) Avatar upload — без двойного открытия диалога
    (function(){
      const avatarInput = document.getElementById('avatar-input');
      const avatarImg   = document.getElementById('avatar-img');
      const avatarForm  = document.getElementById('avatar-form');
      const badge       = document.getElementById('avatar-badge');
      if (!avatarInput || !avatarImg || !avatarForm) return;

      // Не даём форме сабмититься
      avatarForm.addEventListener('submit', (e)=> e.preventDefault());

      let isUploading = false;
      avatarInput.addEventListener('change', async function(){
        if (isUploading) return; // защита от повторного открытия
        if (!this.files || !this.files[0]) return;
        const file = this.files[0];
        if (!/^image\/(png|jpe?g|webp)$/i.test(file.type)) { alert('Только PNG/JPG/WEBP'); this.value=''; return; }
        if (file.size > 6 * 1024 * 1024) { alert('Файл слишком большой (>6MB)'); this.value=''; return; }
        const formData = new FormData(avatarForm);
        isUploading = true;
        avatarImg.style.opacity = .6;
        if (badge){ badge.innerHTML = '<i class="fa fa-spinner uploading"></i>'; }
        try{
          const res = await fetch('{{ url_for("upload_avatar") }}', { method:'POST', body: formData, credentials:'include', headers: {
        'X-CSRFToken': csrfToken   // <<< вот ключевой момент
      } });
          if(!res.ok){ throw new Error('HTTP '+res.status); }
          const data = await res.json();
          if (data.success && data.filename){
            const newSrc = "{{ url_for('static', filename='avatars/') }}" + data.filename + "?v=" + Date.now();
            avatarImg.src = newSrc;
          } else {
            alert('Ошибка: ' + (data.error || 'Не удалось загрузить'));
          }
        }catch(e){ console.error(e); alert('Произошла ошибка загрузки'); }
        finally{
          avatarImg.style.opacity = 1;
          if (badge){ badge.innerHTML = '<i class="fa fa-camera"></i>'; }
          // очистим значение, чтобы можно было выбрать тот же файл ещё раз позже
          this.value = '';
          isUploading = false;
        }
      });
    })();

    // 4) Popular scroll: drag scroll
    (function(){
      const sc = document.getElementById('popular-scroll-id');
      if (!sc) return;
      let isDown=false, startX=0, scrollLeft=0;
      sc.addEventListener('pointerdown', e=>{ isDown=true; sc.setPointerCapture(e.pointerId); startX= e.clientX; scrollLeft=sc.scrollLeft; });
      sc.addEventListener('pointerup', ()=>{ isDown=false; });
      sc.addEventListener('pointercancel', ()=>{ isDown=false; });
      sc.addEventListener('pointermove', e=>{ if(!isDown) return; sc.scrollLeft = scrollLeft - (e.clientX - startX) * 1.4; });
    })();

    // 5) Testimonials dots
    (function(){
      const dots = document.querySelectorAll('.testimonial-dot');
      const slides = document.querySelectorAll('.testimonial-slide');
      if (!dots.length) return;
      dots.forEach((d)=>d.addEventListener('click',()=>{
        dots.forEach(x=>x.classList.remove('active')); d.classList.add('active');
        slides.forEach(s=>s.classList.remove('active')); slides[+d.dataset.slide].classList.add('active');
      }));
    })();
  </script>
</body>
</html>