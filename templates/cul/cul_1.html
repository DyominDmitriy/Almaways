<!DOCTYPE html>
<html lang="ru">
 <head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <title data-i18n="_">
   –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–π —Ü–µ–Ω—Ç—Ä
  </title>
  <script src="/static/js/translate.js" defer></script>
  <link rel="stylesheet" href="/static/css/cul_common.css"/>
  <style>
    header {
      background-image: url('../static/img/culture.jpg');
      background-size: cover;
      background-position: center;
      height: 300px;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      text-decoration: none;
      color:white;
    }
  </style>
 </head>
 <body>
  <header>
   <button class="header-button" data-i18n="__">
    <a class="a_but" data-i18n="__" href="#map">
     –ú–∞—Ä—à—Ä—É—Ç –Ω–∞ –∫–∞—Ä—Ç–µ
    </a>
   </button>
  </header>
  <div class="container">
   <a data-i18n="" href="javascript:history.back()" style="font-size: 28px;">
    ‚Üê
   </a>
   <h1 data-i18n="_">
    –û –º–∞—Ä—à—Ä—É—Ç–µ
   </h1>
   <p data-i18n="____________">
    –ü–æ–≥—Ä—É–∂–µ–Ω–∏–µ –≤ –ø—Ä–æ—à–ª–æ–µ –ê–ª–º–∞—Ç—ã —Å–∫–≤–æ–∑—å —Å—Ç–∞—Ä–∏–Ω–Ω—ã–µ —É–ª–∏—Ü—ã, –∫—É–ª—å—Ç–æ–≤—ã–µ –∑–¥–∞–Ω–∏—è –∏ –∞—Ç–º–æ—Å—Ñ–µ—Ä—É –ø—Ä–æ—à–ª–æ–≥–æ –≤–µ–∫–∞.
   </p>
   <div class="icons">
    <div data-i18n="_">
     ‚òï –ï–¥–∞
    </div>
    <div data-i18n="_">
     üß∂ –ü–µ—à–∫–æ–º
    </div>
    <div data-i18n="_">
     üì∑ –§–æ—Ç–æ
    </div>
   </div>
   <div class="route-point">
    <img alt="–ó–µ–ª—ë–Ω—ã–π –±–∞–∑–∞—Ä" src="../static/img/park.jpeg"/>
    <div class="route-info">
     <h3 data-i18n="_28_">
      –ü–∞—Ä–∫ 28 –≥–≤–∞—Ä–¥–µ–π—Ü–µ–≤-–ø–∞–Ω—Ñ–∏–ª–æ–≤—Ü–µ–≤
     </h3>
     <p data-i18n="______">
      –∑–µ–ª—ë–Ω–æ–µ —Å–µ—Ä–¥—Ü–µ —Å—Ç–∞—Ä–æ–≥–æ –≥–æ—Ä–æ–¥–∞ —Å –ø–∞–º—è—Ç–Ω–∏–∫–∞–º–∏ –≥–µ—Ä–æ–∏–∑–º—É.
     </p>
     <p data-i18n="30_">
      <strong data-i18n="30_">
       30 –º–∏–Ω.
      </strong>
     </p>
    </div>
   </div>
   <div class="route-point">
    <img alt="–ß–∞–π—Ö–∞–Ω–∞" src="../static/img/sobor.jpeg"/>
    <div class="route-info">
     <h3>
      –°–æ–±–æ—Ä –í–æ–∑–Ω–µ—Å–µ–Ω–∏—è (–ó–µ–Ω–∫–æ–≤—Å–∫–∏–π —Å–æ–±–æ—Ä)
     </h3>
     <p >
      –¥–µ—Ä–µ–≤—è–Ω–Ω—ã–π —Ö—Ä–∞–º, –ø–µ—Ä–µ–∂–∏–≤—à–∏–π –∑–µ–º–ª–µ—Ç—Ä—è—Å–µ–Ω–∏–µ.
     </p>
     <p data-i18n="50_">
      <strong data-i18n="50_">
       50 –º–∏–Ω.
      </strong>
     </p>
    </div>
   </div>
   <div class="route-point">
    <img alt="–§—É–¥-—Ç—Ä–∞–∫–∏" src="../static/img/music.jpg"/>
    <div class="route-info">
     <h3 >
      –ú—É–∑–µ–π –Ω–∞—Ä–æ–¥–Ω—ã—Ö –º—É–∑—ã–∫–∞–ª—å–Ω—ã—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
     </h3>
     <p>
      —É—é—Ç–Ω–æ–µ –º–µ—Å—Ç–æ —Å –∫–∞–∑–∞—Ö—Å–∫–æ–π –∫—É–ª—å—Ç—É—Ä–æ–π –≤ –∑–≤—É–∫–∞—Ö.
     </p>
     <p data-i18n="1_">
      <strong data-i18n="1_">
       1 —á.
      </strong>
     </p>
    </div>
   </div>
   <button class="route-done-btn" data-i18n="@" id="cul_1">
    ‚úî –ú–∞—Ä—à—Ä—É—Ç –ø—Ä–æ–π–¥–µ–Ω
   </button>
   <button class="route-fav-btn" data-i18n="" id="cul_1_fav">
    –ü–æ–Ω—Ä–∞–≤–∏–ª—Å—è
   </button>
  </div>
  <div class="map">
   <iframe allowfullscreen="true" data-i18n="" frameborder="0" height="100%" id="map" src="https://yandex.com/map-widget/v1/?um=constructor%3Aca7395e60595a8100c3953a79a863df53c9b2a78382a461cf475eeb0700feff8&amp;source=constructor" width="100%">
    &gt;
   </iframe>
  </div>
 </body>
</html>
<script>
 // –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞—á–∞–ª—å–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
  async function loadInitialState() {
      try {
          const response = await fetch('/get_current_user_state');
          const data = await response.json();
          
          if (data.completed_routes) {
              Object.entries(data.completed_routes).forEach(([routeId, isCompleted]) => {
                  const button = document.getElementById(routeId);
                  if (button) {
                      button.textContent = isCompleted ? '–°–ø–∞—Å–∏–±–æ!' : '‚úî –ú–∞—Ä—à—Ä—É—Ç –ø—Ä–æ–π–¥–µ–Ω';
                      button.classList.toggle('done', isCompleted);
                  }
              });
          }
      } catch (error) {
          console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è:", error);
      }
  }
  
  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–æ–≤
  async function handleRouteClick(button) {
      const routeId = button.id;
      const isCurrentlyCompleted = button.classList.contains('done');
      const newState = !isCurrentlyCompleted;
      
      try {
          button.disabled = true;
          
          const response = await fetch('/update_route_state', {
              method: 'POST',
              headers: {'Content-Type': 'application/json'},
              body: JSON.stringify({
                  route_id: routeId,
                  new_state: newState
              })
          });
          
          const result = await response.json();
          
          if (result.status === "success") {
              button.textContent = newState ? '–°–ø–∞—Å–∏–±–æ!' : '‚úî –ú–∞—Ä—à—Ä—É—Ç –ø—Ä–æ–π–¥–µ–Ω';
              button.classList.toggle('done', newState);
              console.log("–°–æ—Å—Ç–æ—è–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–æ:", result);
          }
      } catch (error) {
          console.error("–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:", error);
          // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏ –æ—à–∏–±–∫–µ
          button.textContent = isCurrentlyCompleted ? '–°–ø–∞—Å–∏–±–æ!' : '‚úî –ú–∞—Ä—à—Ä—É—Ç –ø—Ä–æ–π–¥–µ–Ω';
          button.classList.toggle('done', isCurrentlyCompleted);
      } finally {
          button.disabled = false;
      }
  }
  
  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
  document.addEventListener('DOMContentLoaded', () => {
      loadInitialState();
      
      // –ù–∞–∑–Ω–∞—á–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –≤—Å–µ–º –∫–Ω–æ–ø–∫–∞–º
      document.querySelectorAll('.route-done-btn').forEach(btn => {
          btn.onclick = () => handleRouteClick(btn);
      });
  });
</script>
<script>
 // –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞—á–∞–ª—å–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
  async function loadInitialStateFav() {
    try {
        const response = await fetch('/get_current_user_state_fav');
        const data = await response.json();
        
        if (data.favourite_routes) {  // ‚Üê –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ —Å completed_routes –Ω–∞ favourite_routes
            Object.entries(data.favourite_routes).forEach(([routeId, isFavourite]) => {
                const button = document.getElementById(routeId);
                if (button) {
                    button.textContent = isFavourite ? '–≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–º ' : '–ü–æ–Ω—Ä–∞–≤–∏–ª—Å—è ';
                    button.classList.toggle('done', isFavourite);
                }
            });
        }
    } catch (error) {
        console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è:", error);
    }
}
  
  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–æ–≤
  async function handleRouteClickFav(button) {
      const routeId = button.id;
      const isCurrentlyFavourite = button.classList.contains('done');
      const newState = !isCurrentlyFavourite;
      
      try {
          button.disabled = true;
          
          const response = await fetch('/update_route_state_fav', {
              method: 'POST',
              headers: {'Content-Type': 'application/json'},
              body: JSON.stringify({
                  route_id: routeId,
                  new_state_fav: newState
              })
          });
          
          const result = await response.json();
          
          if (result.status === "success") {
              button.textContent = newState ? '–≤ –ò–∑–±—Ä–∞–Ω–æ–º' : '–ü–æ–Ω—Ä–∞–≤–∏–ª—Å—è ';
              button.classList.toggle('done', newState);
              console.log("–°–æ—Å—Ç–æ—è–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–æ:", result);
          }
      } catch (error) {
          console.error("–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:", error);
          // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏ –æ—à–∏–±–∫–µ
          button.textContent = isCurrentlyFavourite ? '–≤ –ò–∑–±—Ä–∞–Ω–æ–º' : '–ü–æ–Ω—Ä–∞–≤–∏–ª—Å—è ';
          button.classList.toggle('done', isCurrentlyFavourite);
      } finally {
          button.disabled = false;
      }
  }
  
  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
  document.addEventListener('DOMContentLoaded', () => {
      loadInitialStateFav();
      
      // –ù–∞–∑–Ω–∞—á–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –≤—Å–µ–º –∫–Ω–æ–ø–∫–∞–º
      document.querySelectorAll('.route-fav-btn').forEach(btn => {
          btn.onclick = () => handleRouteClickFav(btn);
      });
  });
</script>
